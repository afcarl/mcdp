
htmltmpdir=out-html


manual_html=$(htmltmpdir)/manual.html
manual_tmp_html=$(htmltmpdir)/manual_tmp.html
manual_pdf_wk=$(htmltmpdir)/manual-wk.pdf
manual_pdf_prince=$(htmltmpdir)/manual-prince.pdf

all: \
	$(manual_html) \
	$(manual_pdf_wk) \
	$(manual_pdf_prince)

prince: $(manual_pdf_prince)

.PHONY: $(manual_pdf_prince)

$(manual_html): $(manual_tmp_html)
	npm install MathJax-node jsdom
	node prerender.js $^ $@

$(manual_tmp_html):
	DISABLE_CONTRACTS=1 mcdp-render-manual --output_file $@ -c rparmake
	
# prerender:


$(manual_pdf_wk): $(manual_html)  
	wkhtmltopdf --print-media-type $< $@ 

clean:
	rm -rf out-mcdp-render-manual
	rm -rf $(manual_html)
	rm -rf $(manual_tmp_html)

publish: $(manual_html)
	#cp $< ~/env_mcdp/src/mcdp-gh-pages/media/pymcdp-manual.html
	cp $< ~/env_mcdp/src/mcdp/src/mcdp_web/static/manual.html
	cp $< ~/env_mcdp/src/mcdp/docs/media/pymcdp-manual.html

prince_css=prince.css
$(manual_pdf_prince): $(manual_html) $(prince_css)
	prince --javascript -s $(prince_css) $< -o $@