{% extends "base_page.jinja2" %}

{% block title %}
    Library {{navigation.library_name}}
{% endblock %}

{% block head_extra %}
    <style>{% include 'library_index.css' %}</style>
    <script>{% include 'library_index.js' %}</script>
{% endblock %}

{% block content %}

    {% set can_write = shelf_can_write(navigation.repo_name, navigation.shelf_name) %}
    {% set shelf_url_ = shelf_url(navigation.repo_name, navigation.shelf_name) %}

    {% include 'refresh_shortcut.jinja2' %}
    {% include 'model_views_navigation.jinja2' %}

    <div id='allcontents' >
        <div id='outside'>
        <table align='center' id='library-contents'>
        <thead>
        <tr>
            <td colspan="5">
                {{icon_shelf|safe}}&nbsp;<a href="{{shelf_url_}}/">{{navigation.shelf_name}}</a> /
                {{icon_library|safe}}&nbsp;<code>{{navigation.library_name}}</code>
            </td>
        </tr>
        <tr id="things">
        	<td>MCDPs</td>
        	<td>Templates</td>
        	<td>Posets</td>
        	<td>Values</td>
        	{% if navigation['documents'] %}
        	<td>Documents</td>
        	{% endif %}
        </tr></thead>

        <tbody>
            <tr>
            	{% for what in ["models","templates","posets","values","documents"] %}
            	<!-- only put the documents if they exist -->
            	{% if what != 'documents' or navigation[what] %}
                    <td>
                    	{% if not navigation[what] %}
                    	   <p class='none-available'>(none)</p><br/>
                    	{% endif %}

                    	{% for d in navigation[what] %}
                    		<p class='entry'>
                    		{% if 'url_edit' in d and can_write %}
                                <a class='url_edit' href="{{d['url_edit']}}">✎</a>
                                <a class='url_edit' href="{{d['url_delete']}}">♻</a>
                              {% endif %}
                                <code><a class="url" href="{{d['url']}}">{{icon_spec(what)|safe}}&nbsp;{{d['id']}}</a></code>
                    		</p>
                    	{% endfor %}

                    </td>
            	{% endif %}
            	{% endfor %}

            </tr>
            <tr>
                {% for what in ["models","templates","posets","values","documents"] %}
                    {% if what != 'documents' or navigation[what] %}
                        <td class='plus'>
                            {% if what != 'documents' %}
                                {% if can_write %}
                                    <button id="table_new_{{what}}">+</button>
                                {% endif %}
                            {% endif %}
                        </td>
                    {% endif %}
                {% endfor %}
            </tr>

        </tbody>

        </table>

        <div id='extra_commands'>
        {% if not can_write %}
            <p> This library is read-only for this user. </p>
        {%endif%}

        {% if navigation['models'] %}
            <p><button id='show_previews'>Show MCDP previews</button></p>
        {% endif %}
        </div>

        </div>



        <div id='previews' style='display: none;'>
        {% for m in navigation['models'] %}

        <a class='modellink' href="{{m['url']}}">
        <div id='{{ m["id"] }}-div' class="compact">
        	<span class="name">
        		<code>{{ m['id'] }}</code>
        	</span>

        	<img id='{{ m["id_ndp"] }}-image' src='{{static}}/white_small.png'/>

        	<script type='text/javascript'>
        		tmp_img="{{library_url(navigation.library_name)}}/models/{{m['id_ndp']}}/views/images/ndp_graph_templatized.png";
        		tmp_target = '#{{ m["id_ndp"] }}-image';
        		all_images.push([tmp_img, tmp_target]);

        	function {{ m["id_ndp"] }}_callback() {
        		src = "{{library_url(navigation.library_name)}}/models/{{m['id_ndp']}}/views/images/ndp_graph_templatized.png";

        		which = '#{{ m["id_ndp"] }}-image';

        		$(which).prop('src', src);
        	}

        	$(document).ready(function() {
        		$( '#{{ m["id_ndp"] }}-div' ).hover({{ m["id_ndp"] }}_callback);
        	});

        	</script>


        </div>
        </a>
        {% endfor %}
        </div>

     </div>


{% endblock %}
