<style type='text/css'>
#outer {display: inline-block;}
  #outer li {padding: 5px; }
  #outer a {text-decoration: none;}
  #home, #menu { display: inline-block;}
</style>
<a id='home' style='visibility: hidden' href="/">⌂</a>
<div id='outer'>
<ul id="menu" style='visibility: hidden'>
<li id='root'>&#9776;
<ul>
  <li class="l1" id='menu_new'><span><span class='unicode-icons'>✎</span>New&hellip;</span>
    <ul>
      <li><a id='new_model'><span class='unicode-icons'>&#10213;</span> model&hellip;</a></li>
      <li><a id='new_template'><span class='unicode-icons'>&#x2661;</span>template&hellip;</a></li>
      <li><a id='new_poset'><span class='unicode-icons'>&#x28B6;</span>poset&hellip;</a></li>
      <li><a id='new_value'><span class='unicode-icons'>&#x2723;</span>value&hellip;</a></li>
    </ul>
  </li>
  <li class="l1">Other
  <ul>
  <li>
    <a href="/libraries/{{navigation['current_library']}}/qr_reader/">Import using QR</a>
  </li>
  <li>
    <a href="/libraries/{{navigation['current_library']}}/refresh_library">Refresh library caches</a>
  </li>
  <li>
   <a href="/libraries/{{navigation['current_library']}}/interactive/mcdp_value/">
   	Interactive evaluation</a>
   </li>
  <li>
    	<a href="{{request.url}}" target="_blank">open a copy of this page</a>
   </li>
  </ul>
  </li>
</ul>
</li>
</ul>

</div>

<script type='text/javascript'>
$(document).ready(function() {
  options = { position: { my: "left top", at: "right top" } };
  $('#menu').menu(options);
  $('#menu').css('visibility', 'visible');
  $("#home").css('visibility', 'visible');
})
</script>
  
<style type='text/css'>
/* This makes the link fill all of the menu item
  otherwise it is hard to click */
li a { display: block; width: 90%; } 


.ui-widget {
    font-size:70%;
}
#menu {
	/* font-size: 80%; */

}
#menu li li li {
	width: 14em;
}
li#root {width: 1em;}

#outer {
/*	font-size: 80%; */
}
#outer { 	

}

 .l1 { 
  
  }
</style>


<script type="text/javascript">
function valid_identifier(s) {
	var reg = /^[a-zA-Z_$][0-9a-zA-Z_$]*$/g;
	var match = reg.test(s);
	console.log(reg);
	console.log(s);
	console.log(match);
	if(!match) {
		return false;
	} else {
		return true;
	}
}

// function prompt_user0(what, url_base) {
//   s  = "Please enter the name for the new " + what + ":";
//   var name=prompt(s);
//   if(name == null) {
//   	return;
//   }
//   if(!valid_identifier(name)) {
//     msg = 'The string "'+name+'" is not a valid identifier.';
//   	alert(msg);
//   	return;
//   }
//   url = url_base + name;
//   var win = window.open(url, '_blank');
//   if (win) {
//       //Browser has allowed it to be opened
//       win.focus();
//   } else {
//       //Browser has blocked it
//       alert('Please allow popups for this application.');
//   }
// }

var g_what = null;
var g_url_base = null;
var dialog = null;


function create0(name) {
  if(name == null) {
    return;
  }
  if(!valid_identifier(name)) {
    msg = 'The string "'+name+'" is not a valid identifier.';
    alert(msg);
    return;
  }
  url = g_url_base + name;
  var win = window.open(url, '_blank');
  if (win) {
      //Browser has allowed it to be opened
      win.focus();
  } else {
      //Browser has blocked it
      alert('Please allow popups for this application.');
  }
}

function prompt_user(what, url_base) {
  g_what = what;
  g_url_base = url_base;
  dialog.dialog( "open" );
  // s  = "Please enter the name for the new " + what + ":";
  // var name=prompt(s);
  // if(name == null) {
  //   return;
  // }
  // if(!valid_identifier(name)) {
  //   msg = 'The string "'+name+'" is not a valid identifier.';
  //   alert(msg);
  //   return;
  // }
  // url = url_base + name;
  // var win = window.open(url, '_blank');
  // if (win) {
  //     //Browser has allowed it to be opened
  //     win.focus();
  // } else {
  //     //Browser has blocked it
  //     alert('Please allow popups for this application.');
  // }
}
$(document).ready(function() {
  //$("#home").button();

  url_base = "/libraries/{{navigation['current_library']}}/";

  function new_model() {
    url = url_base + 'models/new/';
    prompt_user('model', url);
  }
  
  function new_template() {
    url = url_base + 'templates/new/';
    prompt_user('template', url);
  }
  
  function new_value() {
    url = url_base + 'values/new/';
    prompt_user('value', url);
  }

  function new_poset() {
    url = url_base + 'posets/new/';
    prompt_user('poset', url);
  }

  $('#new_model').click(new_model);
  $('#new_poset').click(new_poset);
  $('#new_template').click(new_template);
  $('#new_value').click(new_value);
	
	
  $("#outer").show();

  dialog =  $( "#dialog-form" ).dialog({
    autoOpen: false,
    // height: 200,
    width: 350,
    modal: true,
    buttons: {
      "Create": function() {
        var valid = true;
        $( "#name" ).removeClass( "ui-state-error" );
        use = $( "#name" ).val();
        console.log(use);
        valid = valid && valid_identifier(use);
        if(valid) {
          dialog.dialog( "close" );
          create0(use);
        } else {
          $("#form_error").text("Invalid identifier “"+use+"”.");
        }
        return valid;
      },
      Cancel: function() {
        dialog.dialog( "close" );
      }
    },
    close: function() {
      // form[ 0 ].reset();
      $( "#name" ).removeClass( "ui-state-error" );
    }
    });

  });

  $("#outer").hide();


</script> 


<div id="dialog-form" title="Create new" style='display: none'>
<!--   <p class="validateTips">All form fields are required.</p>
 --> 
  <form >
    <fieldset style='border:0'>
      <label for="name">Name</label>
      <input type="text" name="name" id="name" value="" 
            class="  ">
<!--       <label for="email">Email</label>
      <input type="text" name="email" id="email" value="jane@smith.com" class="text ui-widget-content ui-corner-all">
      <label for="password">Password</label>
      <input type="password" name="password" id="password" value="xxxxxxx" class="text ui-widget-content ui-corner-all">
 
 -->      <!-- Allow form submission with keyboard without duplicating the dialog button -->
      <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
    </fieldset>
  </form>
  <p style='color:red' id='form_error'></p>
  <p>Valid identifiers start with a letter or underscore 
  and can contain letters, underscores, numbers, subscripts,
  and greek letters.</p>
</div>